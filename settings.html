<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Alert Electron ì„¤ì •</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: #f5f5f5;
      padding: 20px;
    }
    .container {
      max-width: 750px;
      margin: 0 auto;
      background: white;
      border-radius: 8px;
      padding: 40px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }
    h1 {
      color: #333;
      margin-bottom: 10px;
      font-size: 32px;
    }
    .subtitle {
      color: #666;
      margin-bottom: 20px;
      font-size: 16px;
    }
    .form-group {
      margin-bottom: 20px;
    }
    .form-group label {
      display: block;
      font-weight: 600;
      color: #333;
      margin-bottom: 10px;
      font-size: 16px;
    }
    .form-group input,
    .form-group select {
      width: 100%;
      padding: 14px;
      border: 2px solid #e0e0e0;
      border-radius: 6px;
      font-size: 16px;
      transition: border-color 0.3s ease;
    }
    .form-group input:focus,
    .form-group select:focus {
      outline: none;
      border-color: #667eea;
    }
    .form-group .help-text {
      font-size: 14px;
      color: #666;
      margin-top: 8px;
      line-height: 1.6;
    }
    .toggle-group {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 6px;
      margin-bottom: 25px;
    }
    .toggle-group label {
      font-weight: 600;
      color: #333;
      margin: 0;
      font-size: 16px;
    }
    .toggle-switch {
      position: relative;
      width: 50px;
      height: 26px;
      background: #ccc;
      border-radius: 13px;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    .toggle-switch.active {
      background: #667eea;
    }
    .toggle-switch::after {
      content: '';
      position: absolute;
      width: 20px;
      height: 20px;
      background: white;
      border-radius: 50%;
      top: 3px;
      left: 3px;
      transition: left 0.3s ease;
    }
    .toggle-switch.active::after {
      left: 27px;
    }
    .status-box {
      padding: 20px;
      background: #f8f9fa;
      border-radius: 6px;
      margin-bottom: 25px;
    }
    .status-box .status-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 12px;
      font-size: 15px;
    }
    .status-box .status-item:last-child {
      margin-bottom: 0;
    }
    .status-box .status-label {
      color: #666;
    }
    .status-box .status-value {
      color: #667eea;
      font-weight: 600;
      font-family: monospace;
    }
    .status-box .status-value.success {
      color: #28a745;
    }
    .status-box .status-value.error {
      color: #dc3545;
    }
    .btn {
      padding: 16px 24px;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 500;
      width: 100%;
      margin-bottom: 10px;
    }
    .btn-primary {
      background: #667eea;
      color: white;
    }
    .btn-primary:hover {
      background: #5568d3;
    }
    .btn-secondary {
      background: #6c757d;
      color: white;
    }
    .btn-secondary:hover {
      background: #5a6268;
    }
    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    .info-box {
      background: #e7f3ff;
      border-left: 4px solid #667eea;
      padding: 15px;
      border-radius: 4px;
      margin-bottom: 20px;
    }
    .info-box p {
      margin: 0;
      color: #0c5460;
      line-height: 1.6;
      font-size: 15px;
    }
    .warning-box {
      background: #fff3cd;
      border-left: 4px solid #ffc107;
      padding: 15px;
      border-radius: 4px;
      margin-bottom: 20px;
    }
    .warning-box p {
      margin: 0;
      color: #856404;
      line-height: 1.6;
      font-size: 15px;
    }
    .help-btn {
      background: #6c757d;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      cursor: pointer;
      margin-bottom: 20px;
      width: 100%;
    }
    .help-btn:hover {
      background: #5a6268;
    }
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
    }
    .modal-content {
      background-color: white;
      margin: 10% auto;
      padding: 30px;
      border-radius: 8px;
      width: 90%;
      max-width: 500px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    }
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    .modal-header h2 {
      margin: 0;
      font-size: 24px;
      color: #333;
    }
    .close {
      color: #aaa;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
      line-height: 20px;
    }
    .close:hover {
      color: #000;
    }
    .modal-body {
      font-size: 16px;
      line-height: 1.8;
      color: #333;
    }
    .modal-body ol {
      margin: 0;
      padding-left: 20px;
    }
    .modal-body li {
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ”” Alert Electron ì„¤ì •</h1>
    <p class="subtitle">NMS ì‹œìŠ¤í…œ ì•Œë¦¼ ì—°ë™ ì„¤ì •</p>
    
    <button type="button" class="help-btn" id="help-btn" style="margin-bottom: 20px;">ğŸ“– ì‚¬ìš©ë²• ë³´ê¸°</button>

 

    <div id="warning-box" class="warning-box" style="display: none;">
      <p id="warning-text"></p>
    </div>

    <form id="config-form">
      <div class="toggle-group">
        <label>ì•Œë¦¼ í™œì„±í™”</label>
        <div class="toggle-switch" id="enabled-toggle"></div>
      </div>


      <div class="form-group">
        <label for="email">ì´ë©”ì¼ *</label>
        <input 
          type="email" 
          id="email" 
          placeholder="ì˜ˆ: user@example.com"
          required
        >
        <div class="help-text">
          <strong>í•„ìˆ˜:</strong> ì‚¬ìš©ì ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”<br>
          ì—…ë¬´í˜‘ì¡°, ìƒë‹´ ìš”ì²­, êµìœ¡ì› ìš”ì²­, íšŒì˜ ì•Œë¦¼ì„ ë°›ìœ¼ë ¤ë©´ ë°˜ë“œì‹œ í•„ìš”í•©ë‹ˆë‹¤
        </div>
      </div>

      <div class="form-group">
        <label for="polling-interval">í´ë§ ê°„ê²© (ì´ˆ)</label>
        <input 
          type="number" 
          id="polling-interval" 
          min="10" 
          max="300" 
          value="300"
          required
        >
        <div class="help-text">ê¶Œì¥: 5ë¶„ (10-300ì´ˆ)</div>
      </div>

      <div class="form-group">
        <label for="notification-types">ì•Œë¦¼ íƒ€ì…</label>
        <select id="notification-types">
          <option value="all">ëª¨ë“  ì•Œë¦¼</option>
          <option value="work_cooperation">ì—…ë¬´í˜‘ì¡° ìš”ì²­</option>
          <option value="sales_consultation">ìƒë‹´ ìš”ì²­</option>
          <option value="institution_request">êµìœ¡ì› ìš”ì²­</option>
          <option value="meeting">íšŒì˜ ì•Œë¦¼</option>
        </select>
        <div class="help-text">ë°›ì„ ì•Œë¦¼ íƒ€ì…ì„ ì„ íƒí•˜ì„¸ìš”</div>
      </div>

      <div class="status-box" id="status-box">
        <div class="status-item">
          <span class="status-label">í˜„ì¬ ì´ë©”ì¼:</span>
          <span class="status-value" id="status-email">ë¡œë”© ì¤‘...</span>
        </div>
        <div class="status-item">
          <div class="status-label">ì•Œë¦¼ ìƒíƒœ:</div>
          <span class="status-value" id="status-enabled">ë¡œë”© ì¤‘...</span>
        </div>
      </div>

      <div class="warning-box" style="margin-bottom: 20px;">
        <p><strong>âš ï¸ ì£¼ì˜ì‚¬í•­</strong></p>
        <div style="margin-top: 10px; line-height: 1.8;">
          <p><li>ë³¸ ì•Œë¦¼ ë„êµ¬ëŠ” ì—…ë¬´ íš¨ìœ¨ í–¥ìƒì„ ìœ„í•œ ë³´ì¡° ìˆ˜ë‹¨ì´ë©°, ì‚¬ìš©ì€ ì„ íƒ ì‚¬í•­ì…ë‹ˆë‹¤.</li></p>
          <p><li>ì•Œë¦¼ ë¯¸ìˆ˜ì‹  ë˜ëŠ” ì‹œê°„ ë‚´ í™•ì¸ ì§€ì—°ìœ¼ë¡œ ë°œìƒí•˜ëŠ” ì—…ë¬´ ëˆ„ë½ì— ëŒ€í•œ ì±…ì„ì€ ì‚¬ìš©ìì—ê²Œ ìˆìŠµë‹ˆë‹¤.</li></p>
          <p><li>ë„¤íŠ¸ì›Œí¬ í™˜ê²½ ë° ì„œë²„ ìƒíƒœì— ë”°ë¼ ì•Œë¦¼ì´ ì§€ì—°ë˜ê±°ë‚˜ ì¼ë¶€ ì „ë‹¬ë˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li></p>
          <p><li>ì¤‘ìš”í•œ ì—…ë¬´ ë° í•„ìˆ˜ í™•ì¸ ì‚¬í•­ì€ ë°˜ë“œì‹œ ì›¹ ì‹œìŠ¤í…œì—ì„œ ì§ì ‘ í™•ì¸í•´ ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.</li></p>
        </div>
      </div>

      <button type="submit" class="btn btn-primary">ì„¤ì • ì €ì¥</button>
    </form>

    <!-- ì‚¬ìš©ë²• íŒì—… ëª¨ë‹¬ -->
    <div id="help-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>ğŸ“– ì‚¬ìš©ë²•</h2>
          <span class="close" id="close-modal">&times;</span>
        </div>
        <div class="modal-body">
          <h3 style="margin-top: 0; color: #667eea;">ì‚¬ìš© ë°©ë²•</h3>
          <ol>
            <li>ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”</li>
            <li>í´ë§ ê°„ê²©ì„ ì„¤ì •í•˜ì„¸ìš” (ê¶Œì¥: 10ì´ˆ)</li>
            <li>ì•Œë¦¼ íƒ€ì…ì„ ì„ íƒí•˜ì„¸ìš”</li>
            <li>"ì„¤ì • ì €ì¥" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”</li>
            <li>ì•±ì´ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ìë™ìœ¼ë¡œ ì•Œë¦¼ì„ í™•ì¸í•©ë‹ˆë‹¤</li>
          </ol>
        </div>
      </div>
    </div>

    </form>
  </div>

  <script>
    // Electron APIëŠ” preload.jsë¥¼ í†µí•´ ë…¸ì¶œë¨
    const ipcRenderer = {
      invoke: (channel, ...args) => window.electronAPI.invoke(channel, ...args),
      on: (channel, callback) => window.electronAPI.on(channel, callback),
      removeListener: (channel, callback) => window.electronAPI.removeListener(channel, callback)
    };

    let config = {};
    let enabledToggle = null;

    // ì„¤ì • ë¡œë“œ
    async function loadConfig() {
      try {
        config = await ipcRenderer.invoke('get-config');
        console.log('ğŸ“¥ ì„¤ì • ë¡œë“œ:', JSON.stringify(config, null, 2));
        console.log('ğŸ“§ ë¡œë“œëœ ì´ë©”ì¼:', config.email || '(ì—†ìŒ)', 'íƒ€ì…:', typeof config.email);

        // í¼ì— ì„¤ì • ê°’ ì±„ìš°ê¸°
        // API URLì€ ê³ ì •ê°’ ì‚¬ìš© (ì‚¬ìš©ì ë³€ê²½ ë¶ˆê°€)
        document.getElementById('email').value = config.email || '';
        document.getElementById('polling-interval').value = (config.pollingInterval || 10000) / 1000;
        document.getElementById('notification-types').value = config.types || 'all';

        // í† ê¸€ ìƒíƒœ ì„¤ì •
        enabledToggle = document.getElementById('enabled-toggle');
        if (config.enabled !== false) {
          enabledToggle.classList.add('active');
        } else {
          enabledToggle.classList.remove('active');
        }

        // ìƒíƒœ ì—…ë°ì´íŠ¸
        updateStatus();
      } catch (error) {
        console.error('âŒ ì„¤ì • ë¡œë“œ ì˜¤ë¥˜:', error);
      }
    }

    // ìƒíƒœ ì—…ë°ì´íŠ¸
    function updateStatus() {
      const emailStatus = document.getElementById('status-email');
      const enabledStatus = document.getElementById('status-enabled');
      const warningBox = document.getElementById('warning-box');
      const warningText = document.getElementById('warning-text');

      if (config.email && config.email.trim()) {
        emailStatus.textContent = config.email;
        emailStatus.className = 'status-value success';
        warningBox.style.display = 'none';
      } else {
        emailStatus.textContent = '(ì„¤ì •ë˜ì§€ ì•ŠìŒ)';
        emailStatus.className = 'status-value error';
        warningBox.style.display = 'block';
        warningText.textContent = 'âš ï¸ ì´ë©”ì¼ì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì—…ë¬´í˜‘ì¡°, ìƒë‹´, êµìœ¡ì›, íšŒì˜ ì•Œë¦¼ì„ ë°›ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
      }

      if (config.enabled !== false) {
        enabledStatus.textContent = 'í™œì„±í™”ë¨';
        enabledStatus.className = 'status-value success';
      } else {
        enabledStatus.textContent = 'ë¹„í™œì„±í™”ë¨';
        enabledStatus.className = 'status-value error';
      }
    }

    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
    function setupEventListeners() {
      // í† ê¸€ í´ë¦­
      enabledToggle = document.getElementById('enabled-toggle');
      enabledToggle.addEventListener('click', async () => {
        enabledToggle.classList.toggle('active');
        const enabled = enabledToggle.classList.contains('active');
        
        console.log('ğŸ”„ í† ê¸€ ìƒíƒœ ë³€ê²½:', enabled);
        
        const currentConfig = await ipcRenderer.invoke('get-config');
        const newConfig = {
          ...currentConfig,
          enabled: enabled
        };
        
        const result = await ipcRenderer.invoke('update-config', newConfig);
        if (result.success) {
          config = result.config;
          updateStatus();
        }
      });

      // í¼ ì œì¶œ
      document.getElementById('config-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const saveBtn = document.querySelector('button[type="submit"]');
        saveBtn.disabled = true;
        saveBtn.textContent = 'ì €ì¥ ì¤‘...';

        try {
          // ì´ë©”ì¼ ì…ë ¥ í•„ë“œì—ì„œ ì§ì ‘ ê°’ ê°€ì ¸ì˜¤ê¸°
          const rawEmailInput = document.getElementById('email');
          const emailRawValue = rawEmailInput.value;
          const emailTrimmedValue = emailRawValue.trim();
          
          console.log('--- ğŸ“§ Renderer ì´ë©”ì¼ ê°’ í™•ì¸ (ì €ì¥ ì§ì „) ---');
          console.log('1. í•„ë“œ ID:', rawEmailInput.id);
          console.log('2. ì…ë ¥ëœ ì›ë³¸ ê°’ (emailRawValue):', emailRawValue, `(ê¸¸ì´: ${emailRawValue.length})`);
          console.log('3. trim() ì²˜ë¦¬ëœ ìµœì¢… ê°’ (emailTrimmedValue):', emailTrimmedValue, `(ê¸¸ì´: ${emailTrimmedValue.length})`);
          console.log('-------------------------------------------');
          
          const enabled = enabledToggle.classList.contains('active');
          const email = emailTrimmedValue;
          // API URLì€ ê³ ì •ê°’ ì‚¬ìš© (ì‚¬ìš©ì ë³€ê²½ ë¶ˆê°€)
          const apiUrl = 'https://nms-system.vercel.app/api/notifications';
          const pollingInterval = parseInt(document.getElementById('polling-interval').value) * 1000;
          const types = document.getElementById('notification-types').value;

          console.log('ğŸ’¾ ì €ì¥ ì‹œì‘:', {
            email,
            emailType: typeof email,
            emailLength: email.length,
            enabled,
            apiUrl,
            pollingInterval,
            types
          });

          // ì´ë©”ì¼ ê²€ì¦
          if (!email) {
            const confirm = window.confirm(
              'âš ï¸ ì´ë©”ì¼ì´ ì—†ìŠµë‹ˆë‹¤.\n' +
              'ì—…ë¬´í˜‘ì¡°, ìƒë‹´, êµìœ¡ì›, íšŒì˜ ì•Œë¦¼ì„ ë°›ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\n' +
              'ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?'
            );
            if (!confirm) {
              saveBtn.disabled = false;
              saveBtn.textContent = 'ì„¤ì • ì €ì¥';
              return;
            }
          }

          const newConfig = {
            apiUrl: apiUrl,
            email: email, // ë¹ˆ ë¬¸ìì—´ë„ í—ˆìš©
            userId: '', // userIdëŠ” í•­ìƒ ë¹ˆ ë¬¸ìì—´
            pollingInterval: pollingInterval,
            types: types,
            enabled: enabled
          };

          // IPC í˜¸ì¶œ ì§ì „ newConfig í™•ì¸
          console.log('4. ìµœì¢… newConfig.email:', email);
          console.log('ğŸ“¤ ì €ì¥í•  ì„¤ì •:', JSON.stringify(newConfig, null, 2));
          console.log('ğŸ“¤ ì´ë©”ì¼ í•„ë“œ ê°’ í™•ì¸:', {
            rawValue: document.getElementById('email').value,
            trimmedValue: email,
            length: email.length,
            isEmpty: email.length === 0
          });

          const result = await ipcRenderer.invoke('update-config', newConfig);

          if (result.success) {
            console.log('âœ… ì €ì¥ ì„±ê³µ:', JSON.stringify(result.config, null, 2));
            console.log('ğŸ“§ ì €ì¥ëœ ì´ë©”ì¼:', result.config?.email || '(ì—†ìŒ)', 'íƒ€ì…:', typeof result.config?.email);

            // ì €ì¥ëœ ì„¤ì •ìœ¼ë¡œ ì—…ë°ì´íŠ¸
            config = result.config;

            // í¼ í•„ë“œ ì—…ë°ì´íŠ¸ (ì €ì¥ëœ ê°’ìœ¼ë¡œ)
            document.getElementById('email').value = result.config.email || '';
            document.getElementById('polling-interval').value = (result.config.pollingInterval || 10000) / 1000;
            document.getElementById('notification-types').value = result.config.types || 'all';

            // í† ê¸€ ìƒíƒœ ì—…ë°ì´íŠ¸
            if (result.config.enabled !== false) {
              enabledToggle.classList.add('active');
            } else {
              enabledToggle.classList.remove('active');
            }

            // ìƒíƒœ ì—…ë°ì´íŠ¸
            updateStatus();

            // ì„±ê³µ ë©”ì‹œì§€
            if (result.config.email && result.config.email.trim()) {
              alert('âœ… ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
            } else {
              alert('âš ï¸ ì„¤ì •ì´ ì €ì¥ë˜ì—ˆì§€ë§Œ ì´ë©”ì¼ì´ ì—†ìŠµë‹ˆë‹¤. ì—…ë¬´í˜‘ì¡°, ìƒë‹´, êµìœ¡ì›, íšŒì˜ ì•Œë¦¼ì„ ë°›ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
          } else {
            console.error('âŒ ì €ì¥ ì‹¤íŒ¨:', result);
            alert('âŒ ì„¤ì • ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
          }
        } catch (error) {
          console.error('âŒ ì €ì¥ ì˜¤ë¥˜:', error);
          alert('âŒ ì„¤ì • ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
        } finally {
          saveBtn.disabled = false;
          saveBtn.textContent = 'ì„¤ì • ì €ì¥';
        }
      });

    }

    // ì‚¬ìš©ë²• íŒì—… ëª¨ë‹¬
    const helpModal = document.getElementById('help-modal');
    const helpBtn = document.getElementById('help-btn');
    const closeModal = document.getElementById('close-modal');

    helpBtn.addEventListener('click', () => {
      helpModal.style.display = 'block';
    });

    closeModal.addEventListener('click', () => {
      helpModal.style.display = 'none';
    });

    window.addEventListener('click', (event) => {
      if (event.target === helpModal) {
        helpModal.style.display = 'none';
      }
    });

    // ì´ˆê¸°í™”
    loadConfig().then(() => {
      setupEventListeners();
    });
  </script>
</body>
</html>

